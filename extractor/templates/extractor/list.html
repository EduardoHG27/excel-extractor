<!-- extractor/templates/extractor/list.html -->
{% extends 'extractor/base.html' %}

{% block content %}
<div class="page-header">
    <h1>游늶 Datos Extra칤dos</h1>
    <p>Lista de todos los registros extra칤dos de archivos Excel</p>
</div>

<div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
    <p>
        <strong>Total de registros:</strong> {{ data_list|length }}
    </p>
    <a href="{% url 'upload_excel' %}" class="btn">游닋 Nuevo Archivo</a>
</div>

{% if data_list %}
<div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse; background-color: white;">
        <thead>
            <tr style="background-color: #2c3e50; color: white;">
                <th style="padding: 15px; text-align: left;">ID</th>
                <th style="padding: 15px; text-align: left;">Cliente</th>
                <th style="padding: 15px; text-align: left;">Proyecto</th>
                <th style="padding: 15px; text-align: left;">Tipo Pruebas</th>
                <th style="padding: 15px; text-align: left;">Fecha</th>
                <th style="padding: 15px; text-align: left;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for item in data_list %}
            <tr style="border-bottom: 1px solid #eee; transition: background-color 0.3s;" 
                onmouseover="this.style.backgroundColor='#f8f9fa'"
                onmouseout="this.style.backgroundColor='white'">
                <td style="padding: 15px;">{{ forloop.counter }}</td>
                <td style="padding: 15px;">{{ item.cliente|default:"-"|truncatechars:30 }}</td>
                <td style="padding: 15px;">{{ item.proyecto|default:"-"|truncatechars:30 }}</td>
                <td style="padding: 15px;">{{ item.tipo_pruebas|default:"-"|truncatechars:30 }}</td>
                <td style="padding: 15px;">{{ item.extracted_date|date:"d/m/Y H:i" }}</td>
                <td style="padding: 15px;">
                    <button onclick="showDetails({{ forloop.counter0 }})" 
                            style="background-color: #3498db; color: white; padding: 5px 10px; border-radius: 3px; border: none; cursor: pointer; font-size: 0.9rem;">
                        Ver Detalles
                    </button>
                </td>
            </tr>
            
            <!-- Detalle expandible -->
            <tr id="details-{{ forloop.counter0 }}" style="display: none; background-color: #f8f9fa;">
                <td colspan="6" style="padding: 25px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div>
                            <strong>Cliente:</strong>
                            <p>{{ item.cliente|default:"No especificado" }}</p>
                        </div>
                        <div>
                            <strong>Proyecto:</strong>
                            <p>{{ item.proyecto|default:"No especificado" }}</p>
                        </div>
                        <div>
                            <strong>Tipo de Pruebas:</strong>
                            <p>{{ item.tipo_pruebas|default:"No especificado" }}</p>
                        </div>
                        <div>
                            <strong>Responsable:</strong>
                            <p>{{ item.responsable_solicitud|default:"No especificado" }}</p>
                        </div>
                        <div>
                            <strong>L칤der Proyecto:</strong>
                            <p>{{ item.lider_proyecto|default:"No especificado" }}</p>
                        </div>
                        <div>
                            <strong>Tipo Aplicaci칩n:</strong>
                            <p>{{ item.tipo_aplicacion|default:"No especificado" }}</p>
                        </div>
                        <div>
                            <strong>N칰mero Versi칩n:</strong>
                            <p>{{ item.numero_version|default:"No especificado" }}</p>
                        </div>
                        
                        {% if item.funcionalidad_liberacion %}
                        <div style="grid-column: 1 / -1;">
                            <strong>Funcionalidad Liberaci칩n:</strong>
                            <div style="background-color: white; padding: 15px; border-radius: 4px; margin-top: 5px;">
                                {{ item.funcionalidad_liberacion|linebreaks }}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if item.detalle_cambios %}
                        <div style="grid-column: 1 / -1;">
                            <strong>Detalle Cambios:</strong>
                            <div style="background-color: white; padding: 15px; border-radius: 4px; margin-top: 5px;">
                                {{ item.detalle_cambios|linebreaks }}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if item.justificacion_cambio %}
                        <div style="grid-column: 1 / -1;">
                            <strong>Justificaci칩n Cambio:</strong>
                            <div style="background-color: white; padding: 15px; border-radius: 4px; margin-top: 5px;">
                                {{ item.justificacion_cambio|linebreaks }}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert" style="text-align: center; padding: 40px;">
    <h3 style="color: #7f8c8d; margin-bottom: 15px;">No hay datos extra칤dos todav칤a</h3>
    <p style="margin-bottom: 20px;">Sube tu primer archivo Excel para comenzar a extraer datos.</p>
    <a href="{% url 'upload_excel' %}" class="btn btn-success">游닋 Subir Primer Archivo</a>
</div>
{% endif %}

<script>
    let openDetail = null;
    
    function showDetails(index) {
        const detailRow = document.getElementById(`details-${index}`);
        
        // Cerrar el detalle abierto previamente si existe
        if (openDetail !== null && openDetail !== index) {
            const previousDetail = document.getElementById(`details-${openDetail}`);
            previousDetail.style.display = 'none';
        }
        
        // Alternar visibilidad del detalle actual
        if (detailRow.style.display === 'none' || detailRow.style.display === '') {
            detailRow.style.display = 'table-row';
            openDetail = index;
        } else {
            detailRow.style.display = 'none';
            openDetail = null;
        }
    }
</script>

<style>
    th {
        font-weight: 600;
    }
    
    tr:hover {
        background-color: #f8f9fa;
    }
</style>
{% endblock %}